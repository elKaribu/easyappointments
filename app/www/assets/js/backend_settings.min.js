/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2020, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.0.0
 * ---------------------------------------------------------------------------- */
window.BackendSettings=window.BackendSettings||{},function(e){"use strict";e.SETTINGS_SYSTEM="SETTINGS_SYSTEM",e.SETTINGS_USER="SETTINGS_USER",e.wp={},e.wi={};var a={};e.initialize=function(n){n=n||!0,$("#cookie-notice-content, #terms-and-conditions-content, #privacy-policy-content").trumbowyg();var i={},s={};(GlobalVariables.settings.system.forEach((function(e){$('input[data-field="'+e.name+'"]').val(e.value),$('select[data-field="'+e.name+'"]').val(e.value),"company_working_plan"===e.name&&(i=$.parseJSON(e.value)),"theme_color"===e.name&&$('input:radio[value="'+e.value+'"]').prop("checked",!0),"website_images"===e.name&&(s=$.parseJSON(e.value)),"customer_notifications"===e.name&&$("#customer-notifications").prop("checked",Boolean(Number(e.value))),"provider_notifications"===e.name&&$("#provider-notifications").prop("checked",Boolean(Number(e.value))),"secretary_notifications"===e.name&&$("#secretary-notifications").prop("checked",Boolean(Number(e.value))),"admin_notifications"===e.name&&$("#admin-notifications").prop("checked",Boolean(Number(e.value))),"require_captcha"===e.name&&$("#require-captcha").prop("checked",Boolean(Number(e.value))),"require_phone_number"===e.name&&$("#require-phone-number").prop("checked",Boolean(Number(e.value))),"display_any_provider"===e.name&&$("#display-any-provider").prop("checked",Boolean(Number(e.value))),"display_cookie_notice"===e.name&&$("#display-cookie-notice").prop("checked",Boolean(Number(e.value))),"cookie_notice_content"===e.name&&$("#cookie-notice-content").trumbowyg("html",e.value),"display_terms_and_conditions"===e.name&&$("#display-terms-and-conditions").prop("checked",Boolean(Number(e.value))),"terms_and_conditions_content"===e.name&&$("#terms-and-conditions-content").trumbowyg("html",e.value),"display_privacy_policy"===e.name&&$("#display-privacy-policy").prop("checked",Boolean(Number(e.value))),"privacy_policy_content"===e.name&&$("#privacy-policy-content").trumbowyg("html",e.value)})),e.wp=new WorkingPlan,e.wp.setup(i),e.wp.timepickers(!1),e.wi=new WebsiteImages,e.wi.setup(s),$("#user-id").val(GlobalVariables.settings.user.id),$("#first-name").val(GlobalVariables.settings.user.first_name),$("#last-name").val(GlobalVariables.settings.user.last_name),$("#email").val(GlobalVariables.settings.user.email),$("#mobile-number").val(GlobalVariables.settings.user.mobile_number),$("#phone-number").val(GlobalVariables.settings.user.phone_number),$("#address").val(GlobalVariables.settings.user.address),$("#city").val(GlobalVariables.settings.user.city),$("#state").val(GlobalVariables.settings.user.state),$("#zip-code").val(GlobalVariables.settings.user.zip_code),$("#notes").val(GlobalVariables.settings.user.notes),$("#timezone").val(GlobalVariables.settings.user.timezone),$("#username").val(GlobalVariables.settings.user.settings.username),$("#password, #retype-password").val(""),$("#calendar-view").val(GlobalVariables.settings.user.settings.calendar_view),$("#user-notifications").prop("checked",Boolean(Number(GlobalVariables.settings.user.settings.notifications))),a=new SystemSettings,n)&&(e.wp.bindEventHandlers(),e.wi.bindEventHandlers(),$('a[data-toggle="tab"]').on("shown.bs.tab",(function(){var e=$(this).attr("href");"#general"===e||"#website"===e||"#business-logic"===e||"#legal-contents"===e?a=new SystemSettings:"#current-user"===e&&(a=new UserSettings),Backend.placeFooterToBottom()})),$(".save-settings").on("click",(function(){var e=a.get();a.save(e)})),$("#username").focusout((function(){var e=$(this);if(!0!==e.prop("readonly")&&""!==e.val()){var a=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_validate_username",n={csrfToken:GlobalVariables.csrfToken,username:e.val(),user_id:e.parents().eq(2).find("#user-id").val()};$.post(a,n).done((function(a){"false"===a?(e.closest(".form-group").addClass("has-error"),Backend.displayNotification(EALang.username_already_exists),e.attr("already-exists","true")):(e.closest(".form-group").removeClass("has-error"),e.attr("already-exists","false"))}))}})),$("#apply-global-working-plan").on("click",(function(){var a=[{text:EALang.cancel,click:function(){$("#message-box").dialog("close")}},{text:"OK",click:function(){var a=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_apply_global_working_plan",n={csrfToken:GlobalVariables.csrfToken,working_plan:JSON.stringify(e.wp.get())};$.post(a,n).done((function(){Backend.displayNotification(EALang.working_plans_got_updated)})).always((function(){$("#message-box").dialog("close")}))}}];GeneralFunctions.displayMessageBox(EALang.working_plan,EALang.overwrite_existing_working_plans,a)})),$("#settings-page .nav li").not(".d-none").first().find("a").tab("show"));!1===GlobalVariables.user.privileges.system_settings.edit&&($("#general, #website, #business-logic").find("select, input, textarea").prop("readonly",!0),$("#general, #website, #business-logic").find("button").prop("disabled",!0)),!1===GlobalVariables.user.privileges.user_settings.edit&&($("#user").find("select, input, textarea").prop("readonly",!0),$("#user").find("button").prop("disabled",!0)),Backend.placeFooterToBottom()}}(window.BackendSettings);
